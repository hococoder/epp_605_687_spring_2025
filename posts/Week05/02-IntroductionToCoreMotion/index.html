<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Mobile Application Development for the iOS Platform"/><link rel="canonical" href="https://hococoder.com/posts/Week05/02-IntroductionToCoreMotion"/><meta name="twitter:url" content="https://hococoder.com/posts/Week05/02-IntroductionToCoreMotion"/><meta name="og:url" content="https://hococoder.com/posts/Week05/02-IntroductionToCoreMotion"/><title>Week 5 - Introduction to Core Motion | Mobile Application Development for the iOS Platform</title><meta name="twitter:title" content="Week 5 - Introduction to Core Motion | Mobile Application Development for the iOS Platform"/><meta name="og:title" content="Week 5 - Introduction to Core Motion | Mobile Application Development for the iOS Platform"/><meta name="description" content="A description of my first post."/><meta name="twitter:description" content="A description of my first post."/><meta name="og:description" content="A description of my first post."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="../../../styles.css" type="text/css"/><script src="../../../../jquery-3.7.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Mobile Application Development for the iOS Platform"/></head><body><div class="layout"><div class="header"><div class="headerLayout"><div class="title">Mobile Application Development for the iOS Platform</div><div class="subtitle">Engineering Program for Professionals - 605.687 - 2024-2025 Academic Year</div><div class="weeklayout"><a class="grow1" href="/epp_605_687_spring_2025/posts/Intro/About Me">About Me</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Intro/Example App">Example App</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week00/00-Week00Overview">Week 0</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week01/00-Week01Overview">Week 1</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week02/00-Week02Overview">Week 2</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week03/00-Week03Overview">Week 3</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week04/00-Week04Overview">Week 4</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week05/00-Week05Overview">Week 5</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week06/00-Week06Overview">Week 6</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week07/00-Week07Overview">Week 7</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week08/00-Week08Overview">Week 8</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week09/00-Week09Overview">Week 9</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week10/00-Week10Overview">Week 10</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week11/00-Week11Overview">Week 11</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week12/00-Week12Overview">Week 12</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week13/00-Week13Overview">Week 13</a></div></div></div><div class="wrapper"><h1>Week 5 - Introduction to Core Motion</h1><p style="float: left">Previous:  <A HREF="../../Week05/01-OnboardSensors/index.html">Onboard Sensors</A></p><p style="float: right">Next:  <A HREF="../../Week05/03-CoreMotionExample/index.html">Core Motion Example</A></p><BR/><BR/><div id="floater">
<h3><u>Page Contents</u></h3>
<ul><li><a href="#frameworkOverview">Framework Overview</a></li><li><a href="#theIosDeviceFrame">The iOS Device Frame</a></li><li><a href="#coreMotionClasses">Core Motion Classes</a></li></ul></div><a name="frameworkOverview"></a>
<h2>Framework Overview</h2><p>CoreMotion is a framework that allows you to access an ever growing set of sensors on your device, enabling you to sense things such as the motion and orientation of the device, as well as other derived products such as the number of steps the user takes. Before we get into those classes, let's talk about the device's coordinate system.</p><a name="theIosDeviceFrame"></a>
<h2>The iOS Device Frame</h2><center><iframe src="https://jh.hosted.panopto.com/Panopto/Pages/Embed.aspx?id=a491961d-021c-43e1-8558-b1ba01065dc9&autoplay=false&offerviewer=true&showtitle=true&showbrand=true&captions=false&interactivity=all" height="720" width="1280" style="border: 1px solid #464646;" allowfullscreen allow="autoplay" aria-label="Panopto Embedded Video Player" aria-description="Week0-04-THIRDPARTYTOOLS-Lecture" ></iframe></center><p>All iOS devices have an established frame, defining the X, Y, and Z axes of the device. The iPhone’s axes are shown in the image below, and the iPad’s frame is oriented in a similar way. The positive Z axis comes out of, and is perpendicular to, the device’s screen. The -Y axis comes out of the charging port, and is parallel to the screen. The X axis is perpendicular to the sides of the device, and completes the set defined by the y and z axes. <img src="../../../week05/iPhoneAxes.png#centerResized" alt="The iPhone X ,Y, and Z axes"/></p><a name="coreMotionClasses"></a>
<h2>Core Motion Classes</h2><h3><code>CMMotionManager</code></h3><p>The <code>CMMotionManager</code> class in <code>CoreMotion</code> provides access to all of the motion data on the device. This data can be pulled, or polled, whenever the application needs it, or it can be pushed to the application, notifying the application when the data changes. <code>CMMotionManager</code> returns data for the accelerometer, gyroscope (gyro), magnetometer, and “deviceMotion”, which is a combination of the accelerometer and gyro.</p><h3><code>CMMotionManager</code> - Accelerometer Data</h3><p>When reading data from the manager, you should always check to see if that motion source is available - some devices may not have the on board sensor you need. For the accelerometer you can check <code>isAccelerometerAvailable</code> on the motion manager. Once you’ve setup an update interval, you can start the collection of data and, in this example, send the data to a particular queue for processing - the main queue here. Performing this sort of processing on a background queue, especially if it is computationally intensive, is important in order to keep the main queue, where the UI operates, performing well. The accelerometer provides the x, y, and z components of the amount of <code>g</code> acting upon the device. Here, <code>g</code>, is the acceleration due to gravity, or 9.8 meters per seconds squared. Even sitting still, you still produce accelerometer readings, since gravity is always acting on the device!</p><pre><code>manager.<span class="property">isAccelerometerAvailable</span>
manager.<span class="call">startAccelerometerUpdates</span>(to: withHandler:) <span class="comment">//withHandler is a completion block so you'll often see it as a trailing closure</span>
</code></pre><h3><code>CMMotionManager</code> - Gryroscope and Device Motion Updates</h3><p>As with the accelerometer, you can use <code>isGyroAvailable</code> to see if the device has a gyro available onboard. You can also query <code>isDeviceMotionAvailable</code>, which will tell you if the accelerometer and gyroscope are on board. You can then use <code>startGyroUpdates(to:)</code> or <code>startDeviceMotionUpdates(to:)</code> in order to send data to a given queue. There are other methods you can call as well - be sure to read the documentation for details. For all of the motion types, don’t forget to stop asking for data when you’re done - in this case you can call <code>stopGyroUpdates()</code> or <code>stopDeviceMotionUpdates()</code>.</p><pre><code>manager.<span class="property">isGyroAvailable</span> <span class="comment">//gyro only</span>
manager.<span class="call">startGyroUpdates</span>(to: withHandler:) 
manager.<span class="call">stopGyroUpdates</span>()

manager.<span class="property">isDeviceMotionAvailable</span> <span class="comment">//accelerometer and gyroscope</span>
manager.<span class="call">startDeviceMotionUpdates</span>(to: withHandler:)
manager.<span class="call">stopDeviceMotionUpdates</span>()
</code></pre><h3>Detecting Shakes</h3><p>Detecting a shake of the device doesn’t use the motion manager. Instead it uses 3 delegate methods on the <code>UIWindow</code> class: <code>motionBegan</code>, <code>motionEnded</code>, and <code>motionCancelled</code>. You can check the type of the motion object that is passed into these methods, and if it is of type <code>UIEventSubtype.motionShake</code>, you can respond accordingly. To do this, extend <code>UIWindow</code>, and override one of those methods, and with it you can send out an event to other listeners via <code>NotificationCenter</code> to let them know the shake took place.</p><pre><code><span class="keyword">extension</span> <span class="type">UIWindow</span> {
    <span class="keyword">open override func</span> motionEnded(<span class="keyword">_</span> motion: <span class="type">UIEvent</span>.<span class="type">EventSubtype</span>, with event: <span class="type">UIEvent</span>?) {
        <span class="keyword">super</span>.<span class="call">motionEnded</span>(motion, with: event)
        <span class="type">NotificationCenter</span>.<span class="property">default</span>.<span class="call">post</span>(name: <span class="type">NSNotification</span>.<span class="type">Name</span>(<span class="string">"ShakeNotification"</span>), object: event)
    }
}
</code></pre><p>You can even test a shake in the simulator. Go to the Device -&gt; Shake menu item to simulate it.</p><h3><code>CMAltimeter</code></h3><p>The <code>CMAltimeter</code> class allows you to detect <em>changes</em> - not actual values - in the user’s altitude on certain devices (here, use <code>isRelativeAltitudeAvailable()</code>). <code>startRelativeAltitudeUpdates</code> provides updates at a regular interval, even if there has been no change since the collection started. Altitude updates are only delivered if the app is running - either in the foreground or background.</p><pre><code>manager.<span class="call">isRelativeAltitudeAvailable</span>()
manager.<span class="call">startRelativeAltitudeUpdates</span>(to: withHandler:)
</code></pre><h3><code>CMMagnetometerData</code></h3><p>The magnetometer can be started with <code>startMagnetometerUpdates</code> after you’ve set an update interval. The data can be processed in your handler block. Beware - cases that have magnetic clasps can interfere with magnetometer readings (especially if you are trying to use the compass!)</p><pre><code>manager.<span class="call">startMagnetometerUpdates</span>(to: withHandler:)
</code></pre><h3><code>CMPedometer</code></h3><p>Modern devices (with M7 and later motion co-processors) have the ability to capture steps like a pedometer. The <code>CMPedometer</code> class allows you to access the historical data, such as steps walked, or distance traveled, via the <code>queryPedometerData(from:to:withHandler:)</code> method. You can also get live data (instead of historical data) from the startUpdates method of the <code>CMPedometer</code> class.</p><p class="new"> The CMHeadphoneMotionManager below is new this year! </p><h3><code>CMHeadphoneMotionManager</code></h3><p>One of the coolest forms of motion that can be captured is that of your AirPods. The <code>CMHeadphoneMotionManager</code> object can capture data from your headphones such as attitude, rotation rate, gravity and user acceleration. If you've ever used Spatial Audio with AirPods Pro, you are experiencing this manager in action. By determining the attitude and rotation of your head (because the AirPods are in your ears) the direction of sounds can be directed to come from specific directions, allowing you to be immersed in the sound.</p><p>In the next module, we'll look at some of these in an example.</p><p style="float: left">Previous:  <A HREF="../../Week05/01-OnboardSensors/index.html">Onboard Sensors</A></p><p style="float: right">Next:  <A HREF="../../Week05/03-CoreMotionExample/index.html">Core Motion Example</A></p><BR/><BR/></div><leftside><u><p>Week 5</p></u><div class="weekSection"><ul><li><div class="comment-container"><div class="tocItem"><a id="Week 05 Overview" href="../../Week05/00-Week05Overview/index.html">Week 05 Overview</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Onboard Sensors" href="../../Week05/01-OnboardSensors/index.html">Onboard Sensors</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Introduction to Core Motion" href="../../Week05/02-IntroductionToCoreMotion/index.html">Introduction to Core Motion</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Core Motion Example" href="../../Week05/03-CoreMotionExample/index.html">Core Motion Example</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Maps In SwiftUI " href="../../Week05/04-MapsInSwiftUI/index.html">Maps In SwiftUI </a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Introduction to CoreLocation" href="../../Week05/05-IntroductionToCoreLocation/index.html">Introduction to CoreLocation</a></div></div></li></ul></div></leftside><footer><p>Generated with ❤️ using <a href="https://github.com/johnsundell/publish">Publish</a></p><p>© 2023-2024 Josh Steele (rsteele3@jhu.edu) <a href="mailto:"(rsteele3@jhu.edu)""></a></p><p>Last updated January 25, 2025 at 1:51 PM</p><p><a href="https://mastodon.social/@hococoder" target="_blank">My Mastodon</a> | <a href="https://github.com/hococoder" target="_blank">My GitHub</a> | <a href="https://ep.jhu.edu" target="_blank">Whiting School EPP</a> | <a href="https://canvas.jhu.edu" target="_blank">JHU Canvas</a></p></footer></div></body></html>
<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Mobile Application Development for the iOS Platform"/><link rel="canonical" href="https://hococoder.com/posts/Week05/05-IntroductionToCoreLocation"/><meta name="twitter:url" content="https://hococoder.com/posts/Week05/05-IntroductionToCoreLocation"/><meta name="og:url" content="https://hococoder.com/posts/Week05/05-IntroductionToCoreLocation"/><title>Week 5 - Introduction to CoreLocation | Mobile Application Development for the iOS Platform</title><meta name="twitter:title" content="Week 5 - Introduction to CoreLocation | Mobile Application Development for the iOS Platform"/><meta name="og:title" content="Week 5 - Introduction to CoreLocation | Mobile Application Development for the iOS Platform"/><meta name="description" content="A description of my first post."/><meta name="twitter:description" content="A description of my first post."/><meta name="og:description" content="A description of my first post."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="../../../styles.css" type="text/css"/><script src="../../../../jquery-3.7.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Mobile Application Development for the iOS Platform"/></head><body><div class="layout"><div class="header"><div class="headerLayout"><div class="title">Mobile Application Development for the iOS Platform</div><div class="subtitle">Engineering Program for Professionals - 605.687 - 2024-2025 Academic Year</div><div class="weeklayout"><a class="grow1" href="/epp_605_687_spring_2025/posts/Intro/About Me">About Me</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Intro/Example App">Example App</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week00/00-Week00Overview">Week 0</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week01/00-Week01Overview">Week 1</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week02/00-Week02Overview">Week 2</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week03/00-Week03Overview">Week 3</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week04/00-Week04Overview">Week 4</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week05/00-Week05Overview">Week 5</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week06/00-Week06Overview">Week 6</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week07/00-Week07Overview">Week 7</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week08/00-Week08Overview">Week 8</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week09/00-Week09Overview">Week 9</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week10/00-Week10Overview">Week 10</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week11/00-Week11Overview">Week 11</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week12/00-Week12Overview">Week 12</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week13/00-Week13Overview">Week 13</a></div></div></div><div class="wrapper"><h1>Week 5 - Introduction to CoreLocation</h1><p style="float: left">Previous:  <A HREF="../../Week05/04-MapsInSwiftUI/index.html">Maps In SwiftUI </A></p><p style="float: right">Next:  <A HREF="../../Week06/00-Week06Overview/index.html">Week 06 Overview</A></p><BR/><BR/><div id="floater">
<h3><u>Page Contents</u></h3>
<ul><li><a href="#frameworkOverview">Framework Overview</a></li><li><a href="#coreLocationClasses">Core Location Classes</a></li><li><a href="#ibeaconProtocol">iBeacon Protocol</a></li><li><a href="#otherTypes">Other Types</a></li></ul></div><a name="frameworkOverview"></a>
<h2>Framework Overview</h2><center><iframe id="myIframe" src="https://jh.hosted.panopto.com/Panopto/Pages/Embed.aspx?id=b458b7cb-c57f-469a-9913-b1ba01066ef5&autoplay=false&offerviewer=true&showtitle=true&showbrand=true&captions=false&interactivity=all"  style="border: 1px solid #464646;" allowfullscreen allow="autoplay" aria-label="Panopto Embedded Video Player" aria-description="Week0-04-THIRDPARTYTOOLS-Lecture" ></iframe></center><p>The Location for your device can be determined from a number of different external signals.</p><ul><li>The Global Positioning System signals can be sensed by the assisted GPS chipset on board the device - that is, if your device supports it.</li><li>Cell tower signals and wifi router signal can also be used to determine device location since the position of the towers and routers are well know and triangulation be used to help determine the location of the device to a certain level of accuracy.</li><li>Finally, low power bluetooth transmitters, especially ones that obey the iBeacon protocol established by Apple, can be used in a similar fashion to determine location inside buildings where GPS or cell tower signals may be obstructed.<ul></ul></li></ul><img src="../../../week05/LocationScale.png#centerResizedSlide" alt="A sense of Location Scale"/><a name="coreLocationClasses"></a>
<h2>Core Location Classes</h2><h3><code>CLLocationManager</code></h3><p><code>CLLocationManager</code> is the main class in the CoreLocation framework that lets you get location information from your device. It can:</p><ul><li>Track location changes with a configurable level of accuracy (based on the source from above)</li><li>Report a heading from compass</li><li>Monitor if the device enters or exits a region</li><li>Calculate the range to nearby beacons.</li></ul><p>As with most powerful classes on iOS, <code>CLLocationManager</code> requires a delegate, called <code>CLLocationManagerDelegate</code>, in order to work properly and provide the exact implementation required for your app. As with <code>CoreMotion</code>, don’t forget to ask for permission (and get it) before using the user’s location. Without that permission, <code>CoreLocation</code> won’t return data.</p><pre><code><span class="comment">//set to: "We would like to use your location data for this demo"</span>
<span class="string">"NSLocationAlwaysAndWhenInUseUsageDescription"</span> (aka <span class="type">Privacy</span> - <span class="type">Location Always</span> and when <span class="keyword">in</span> <span class="type">Use Description</span>)

<span class="comment">//set to: "We would like to use your location data for this demo"</span>
<span class="string">"NSLocationWhenInUseUsageDescription"</span> (aka <span class="type">Privacy</span> - <span class="type">Location</span> when <span class="keyword">in</span> use description) 

<span class="comment">//Once that is set you can request for user authorization</span>
locationManager.<span class="call">requestAlwaysAuthorization</span>()
</code></pre><p>Note that the user may not allow location permission all the time, so you'll have to adjust accordingly. They may also change their location sharing decision after their initial response; you can listen for authorizations in the <code>CLLocationManagerDelegate</code> protocol.</p><h3><code>CLLocation</code></h3><p>The <code>CLLocation</code> class represents the location data generated by a <code>CLLocationManager</code>. The objects:</p><ul><li>Contains geographic coordinates and altitude,</li><li>Provides the accuracy of the measurements,</li><li>Provides time stamps for each of the values collected.</li></ul><p>In iOS, <code>CLLocation</code> also provides speed and heading information. This class is not <em>usually</em> created by the user, but is generated by classes such as the <code>CLLocationManager</code>, and consumed instead in handlers/completion blocks and other processing methods.</p><pre><code><span class="comment">//CLLocation typically comes from the location manager but can be made manually</span>
<span class="keyword">let</span> coordinate = <span class="type">CLLocation</span>(latitude: <span class="number">39.160926</span>, longitude: -<span class="number">76.899872</span>)
<span class="comment">//To get the location from the location manager.  Also provides information like floor, altitude, accuracy values, etc.</span> 
<span class="keyword">let</span> currentLocation = locationManager.<span class="property">location</span>

<span class="comment">//Also has a handy distance method to find the distance between 2 locations</span>
<span class="keyword">let</span> distanceBetween = currentLocation.<span class="call">distance</span>(from: coordinate)

<span class="comment">//An alternative CLLocationCoordinate2D struct is available that returns lat/lon in the WGS84 frame, which is a Earth-centered and Earth-fixed terrestrial reference system, which takes into account the Earth's size, shape and gravity</span>
<span class="keyword">let</span> coordinate = <span class="type">CLLocationCoordinate2D</span>(latitude: <span class="number">39.160926</span>, longitude: -<span class="number">76.899872</span>)
</code></pre><h3>Type Aliases</h3><p>Here are a few common type aliases you run into when working with CoreLocation.</p><ul><li><code>CLLocationDegrees</code> represents a <code>Double</code>, and used to represent a longitudinal or latitudinal value in degrees.</li><li><code>CLLocationDistance</code> is a <code>Double</code>, and used to represent a distance in meters.</li><li><code>CLFloor</code> is the logical floor of the building in which a user is located. It is provided if available and should never be created manually.</li><li><code>CLLocationAccuracy</code> is a <code>Double</code> representing the accuracy of a coordinate value, in meters.</li></ul><h3><code>CLVisit</code></h3><p>The <code>CLVisit</code> class is used to store information about where the user has been. Created by the <code>CLLocationManager</code>, is is delivered to delegate methods, and includes the location, and information about arrival and departure times. This class is not created directly, but instead created by the manager.</p><pre><code><span class="comment">//If you want to respond to a user visiting a particular location, you can use this method</span>
<span class="keyword">func</span> locationManager(<span class="keyword">_</span> manager: <span class="type">CLLocationManager</span>, didVisit visit: <span class="type">CLVisit</span>) {
  <span class="comment">//do something with the visit here, like popup store-specific information</span>
 
}
</code></pre><h3><code>CLCircularRegion</code></h3><p>In addition to giving you exact locations (at least within the accuracy provided) you can define a region - defined by a coordinate and a radius - in the form of a <code>CLCircularRegion</code>. You can directly query the <code>CLCircularRegion</code>’s <code>contains</code> method to see if another coordinate falls within those bounds. <code>CLRegion</code>s are also monitored by the <code>CLLocationManager</code>, and if regions are entered or exited, the manager is notified via one of its delegate methods, such as <code>locationManager(_, didEnterRegion)</code>. This comes into play when setting up geofencing - determining whether a user has entered or exited a region.</p><pre><code><span class="comment">//The delegate methods that come into play here</span>
<span class="keyword">func</span> locationManager(<span class="keyword">_</span> manager: <span class="type">CLLocationManager</span>, didEnterRegion region: <span class="type">CLRegion</span>) {
  <span class="comment">//do something informative like emit a local notification, or start a timer</span>
}
 
<span class="keyword">func</span> locationManager(<span class="keyword">_</span> manager: <span class="type">CLLocationManager</span>, didExitRegion region: <span class="type">CLRegion</span>) {
  <span class="comment">//do something like cancelling a timer, or stopping other service since they are outside the region</span>
}
 
<span class="keyword">func</span> locationManager(<span class="keyword">_</span> manager: <span class="type">CLLocationManager</span>, didChangeAuthorization status: <span class="type">CLAuthorizationStatus</span>) {
  <span class="comment">//respond to changes in the user's authorization to track location</span>
}
</code></pre><a name="ibeaconProtocol"></a>
<h2>iBeacon Protocol</h2><p>Have you ever tried using GPS in a building, especially one that has a structure comprised of materials like steel? GPS has trouble penetrating through such structures, which means that your device has trouble sensing those signals, since their amplitude has been greatly diminished. Wifi routers can be used to determine location, but the accuracy of the method used in that case isn’t very good. To help compensate for this, Apple developed the iBeacon protocol for indoor navigation. iBeacons are Bluetooth low energy (BTLE) transmitters that have about a 70 meters (about 230 feet) range, and emit at well understood power levels. iOS devices can sense the power level of the incoming signal to calculate a range to the beacon. Beacons can be used to establish the center of a region (<code>CLBeaconRegion</code>) and therefore use geofencing. Also, if the app knows where the various beacons are located in a known space, it can use the power levels from the beacons to perform a sort of triangulation, allowing the app to provide indoor mapping. The company Estimote is one of the leading manufacturers of beacons and has a very mature set of hardware and software.</p><a name="otherTypes"></a>
<h2>Other Types</h2><p>Let’s talk about a few more types before we wrap up the discussion for CoreLocation.</p><h3><code>CLHeading</code></h3><p><code>CLHeading</code> contains the computed values for the device’s azimuth, or orientation, relative to true, or magnetic, north. It also contains the raw, 3 dimensional vector used to calculate the heading. You can get instances of <code>CLHeading</code> through the <code>CLLocationManager</code>’s <code>startUpdatingHeading</code> method.</p><pre><code><span class="comment">//get CLHeading objects from the location manager, and print it to the console</span>
<span class="keyword">func</span> locationManager(manager: <span class="type">CLLocationManager</span>!, didUpdateHeading newHeading: <span class="type">CLHeading</span>!) {
    <span class="call">print</span>(newHeading.<span class="property">magneticHeading</span>)
}
</code></pre><h3><code>CLGeoCoder</code></h3><p><code>CLGeoCoder</code> can be used to convert between a coordinate and a user-friendly representation, such as a street, city, and state listing. You can perform both reverse-geocoding (converting coordinates to user friendly representations) and forward-geocoding (converting a user friendly location to a coordinate). These are both returned in a <code>CLPlacemark</code> object. We saw this in the Weather example when we went over Combine and networking.</p><pre><code><span class="comment">//The code from the Weather example</span>
<span class="keyword">let</span> geoCoder = <span class="type">CLGeocoder</span>()
geoCoder.<span class="call">geocodeAddressString</span>(city, completionHandler: { placemarks, error <span class="keyword">in

 guard</span> error == <span class="keyword">nil</span>, <span class="keyword">let</span> placemark = placemarks?[<span class="number">0</span>] <span class="keyword">else</span> {
   <span class="call">completion</span>(kCLLocationCoordinate2DInvalid, error <span class="keyword">as</span> <span class="type">NSError</span>?)
   <span class="keyword">return</span>
 }

 <span class="keyword">let</span> location = placemark.<span class="property">location</span>!
 <span class="call">completion</span>(location.<span class="property">coordinate</span>, <span class="keyword">nil</span>)
 <span class="keyword">return</span>

})
</code></pre><p class="info">An important thing to keep in mind here:  this lookup happens asynchronously, since it has to wait to get information back from Apple's servers.  You need to take this into account when running your code!</p><h3><code>CLPlacemark</code></h3><p><code>CLPlacemark</code>s can contains the name of the location, an address, and other relevant information such as points of interest for that location. You can either get <code>CLPlacemark</code>s from performing reverse-geocoding, or you can create instances of <code>CLPlacemark</code> yourself and populate the information for later use. See the <code>CLGeocoder</code> example for how this is used.</p><p>With those definitions in hand, let's look at some example in the next module.</p><p style="float: left">Previous:  <A HREF="../../Week05/04-MapsInSwiftUI/index.html">Maps In SwiftUI </A></p><p style="float: right">Next:  <A HREF="../../Week06/00-Week06Overview/index.html">Week 06 Overview</A></p><BR/><BR/></div><leftside><u><p>Week 5</p></u><div class="weekSection"><ul><li><div class="comment-container"><div class="tocItem"><a id="Week 05 Overview" href="../../Week05/00-Week05Overview/index.html">Week 05 Overview</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Onboard Sensors" href="../../Week05/01-OnboardSensors/index.html">Onboard Sensors</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Introduction to Core Motion" href="../../Week05/02-IntroductionToCoreMotion/index.html">Introduction to Core Motion</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Core Motion Example" href="../../Week05/03-CoreMotionExample/index.html">Core Motion Example</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Maps In SwiftUI " href="../../Week05/04-MapsInSwiftUI/index.html">Maps In SwiftUI </a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Introduction to CoreLocation" href="../../Week05/05-IntroductionToCoreLocation/index.html">Introduction to CoreLocation</a></div></div></li></ul></div></leftside><footer><p>Generated with ❤️ using <a href="https://github.com/johnsundell/publish">Publish</a></p><p>© 2023-2024 Josh Steele (rsteele3@jhu.edu) <a href="mailto:"(rsteele3@jhu.edu)""></a></p><p>Last updated January 25, 2025 at 6:17 PM</p><p><a href="https://mastodon.social/@hococoder" target="_blank">My Mastodon</a> | <a href="https://github.com/hococoder" target="_blank">My GitHub</a> | <a href="https://ep.jhu.edu" target="_blank">Whiting School EPP</a> | <a href="https://canvas.jhu.edu" target="_blank">JHU Canvas</a></p></footer></div></body></html>
<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Mobile Application Development for the iOS Platform"/><link rel="canonical" href="https://hococoder.com/posts/Week04/11-UpdatingYourAppForCloudKit"/><meta name="twitter:url" content="https://hococoder.com/posts/Week04/11-UpdatingYourAppForCloudKit"/><meta name="og:url" content="https://hococoder.com/posts/Week04/11-UpdatingYourAppForCloudKit"/><title>Week 4 - Syncing with CloudKit | Mobile Application Development for the iOS Platform</title><meta name="twitter:title" content="Week 4 - Syncing with CloudKit | Mobile Application Development for the iOS Platform"/><meta name="og:title" content="Week 4 - Syncing with CloudKit | Mobile Application Development for the iOS Platform"/><meta name="description" content="A description of my first post."/><meta name="twitter:description" content="A description of my first post."/><meta name="og:description" content="A description of my first post."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="../../../styles.css" type="text/css"/><script src="../../../../jquery-3.7.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Mobile Application Development for the iOS Platform"/></head><body><div class="layout"><div class="header"><div class="headerLayout"><div class="title">Mobile Application Development for the iOS Platform</div><div class="subtitle">Engineering Program for Professionals - 605.687 - 2024-2025 Academic Year</div><div class="weeklayout"><a class="grow1" href="/epp_605_687_spring_2025/posts/Intro/About Me">About Me</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Intro/Example App">Example App</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week00/00-Week00Overview">Week 0</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week01/00-Week01Overview">Week 1</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week02/00-Week02Overview">Week 2</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week03/00-Week03Overview">Week 3</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week04/00-Week04Overview">Week 4</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week05/00-Week05Overview">Week 5</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week06/00-Week06Overview">Week 6</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week07/00-Week07Overview">Week 7</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week08/00-Week08Overview">Week 8</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week09/00-Week09Overview">Week 9</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week10/00-Week10Overview">Week 10</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week11/00-Week11Overview">Week 11</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week12/00-Week12Overview">Week 12</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week13/00-Week13Overview">Week 13</a></div></div></div><div class="wrapper"><h1>Week 4 - Syncing with CloudKit</h1><p style="float: left">Previous:  <A HREF="../../Week04/10-CloudKitFeatures/index.html">CloudKit Features</A></p><p style="float: right">Next:  <A HREF="../../Week04/12-IntroductionToSwiftPackageManager/index.html">Introduction to Swift Package Manager</A></p><BR/><BR/><a name="updatingYourAppToUseCloudkit"></a>
<h2>Updating your App to use CloudKit</h2><p>There are 2 different types of databases available in CloudKit - a private one, that is restricted to that user only, and is locked down by their AppleID credentials, and the public database, which can take entries from many users. This comes is handy for tracking things like high scores in a game - it isn't a private value for the user; instead it is something that is shared and compared against ALL users of your app.<br><br>So the question is - how do you take your existing database, and hook it up to the private CloudKit database? Remember when we first setup the CoreData project and we noted the code in <code>Peristance.swift</code> to help us with CoreData? Here's a snippet:</p><pre><code><span class="keyword">let</span> container: <span class="type">NSPersistentContainer</span>

<span class="keyword">init</span>(inMemory: <span class="type">Bool</span> = <span class="keyword">false</span>) {
    container = <span class="type">NSPersistentContainer</span>(name: <span class="string">"EPGradebook"</span>)
    <span class="keyword">if</span> inMemory {
        container.<span class="property">persistentStoreDescriptions</span>.<span class="property">first</span>!.url = <span class="type">URL</span>(fileURLWithPath: <span class="string">"/dev/null"</span>)
    }
    container.<span class="call">loadPersistentStores</span>(completionHandler: { (storeDescription, error) <span class="keyword">in
        if let</span> error = error <span class="keyword">as</span> <span class="type">NSError</span>? {
</code></pre><p>To hook our CoreData up to the public CloudKit, you have to change 1 line of code:</p><pre><code><span class="keyword">let</span> container = <span class="type">NSPersistentContainer</span>(name: <span class="string">"EPGradeBook"</span>)
</code></pre><p>to</p><pre><code><span class="keyword">let</span> container = <span class="type">NSPersistentCloudKitContainer</span>(name: <span class="string">"EPGradeBook"</span>)
</code></pre><p>That's it! With that change, you can now have your data sync with CloudKit! <code>NSPersistentCloudKitContainer</code> is an encapsulation of common patterns Apple saw developers using over and over again, so they decided to make that functionality an entirely new class, saving thousands of lines of code! Some of the things this new class provides:</p><ul><li>A local replica of all the CloudKit data</li><li>Robust scheduling and error recovery</li><li>Transformation of <code>NSManagedObject</code> (from CoreData) to <code>CKRecord</code> (from CloudKit)</li></ul><p>That local replica of data is useful for keeping a high bandwidth for reading and writing between your app and the database - and <code>NSPersistentCloudKitContainer</code> deals with syncing it to the cloud for you. The opposite is also true - if changes in the cloud are made, <code>NSPersistentCloudKitContainer</code> will pull those values down and give you NSManagedObjects you can use in your code. More on this feature, as well as more on Core Data and CloudKit can be see in the WWDC 2019 video <a href="https://developer.apple.com/videos/play/wwdc2019/202/">Using Core Data with CloudKit</a></p><p>So that syncs your database on the device with the private CloudKit container - but what about syncing with the public CloudKit container? Again, it is just one new line of code to add.</p><p class="info">NOTE: This is on Xcode 12 and above ONLY</p><pre><code>description.<span class="property">cloudKitContainerOptions</span>?.<span class="property">databaseScope</span> = .<span class="dotAccess">public</span>
</code></pre><p>More on working with the public CloudKit container can be seen in the WWDC 2020 video <a href="https://developer.apple.com/videos/play/wwdc2020/10650/">Sync a Core Data Store with the CloudKit Public Database</a>)</p><p style="float: left">Previous:  <A HREF="../../Week04/10-CloudKitFeatures/index.html">CloudKit Features</A></p><p style="float: right">Next:  <A HREF="../../Week04/12-IntroductionToSwiftPackageManager/index.html">Introduction to Swift Package Manager</A></p><BR/><BR/></div><leftside><u><p>Week 4</p></u><div class="weekSection"><ul><li><div class="comment-container"><div class="tocItem"><a id="Week 04 Overview" href="../../Week04/00-Week04Overview/index.html">Week 04 Overview</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Introduction to Networking" href="../../Week04/01-IntroductionToNetworking/index.html">Introduction to Networking</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="URL Session Delegate" href="../../Week04/02-URLSessionDelegate/index.html">URL Session Delegate</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Networking Best Practices" href="../../Week04/03-NetworkingBestPractices/index.html">Networking Best Practices</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Networking Example" href="../../Week04/04-NetworkingExample/index.html">Networking Example</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Async Await" href="../../Week04/05-AsyncAwait/index.html">Async Await</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Concurrency" href="../../Week04/06-Concurrency/index.html">Concurrency</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Introduction to CloudKit" href="../../Week04/07-IntroductionToCloudKit/index.html">Introduction to CloudKit</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Setting Up CloudKit" href="../../Week04/08-SettingUpCloudKit/index.html">Setting Up CloudKit</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="CloudKit Schemas" href="../../Week04/09-CloudKitSchemas/index.html">CloudKit Schemas</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="CloudKit Features" href="../../Week04/10-CloudKitFeatures/index.html">CloudKit Features</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Updating Your App For CloudKit" href="../../Week04/11-UpdatingYourAppForCloudKit/index.html">Updating Your App For CloudKit</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Introduction to Swift Package Manager" href="../../Week04/12-IntroductionToSwiftPackageManager/index.html">Introduction to Swift Package Manager</a></div></div></li></ul></div></leftside><footer><p>Generated with ❤️ using <a href="https://github.com/johnsundell/publish">Publish</a></p><p>© 2023-2024 Josh Steele (rsteele3@jhu.edu) <a href="mailto:"(rsteele3@jhu.edu)""></a></p><p>Last updated March 9, 2025 at 6:54 PM</p><p><a href="https://mastodon.social/@hococoder" target="_blank">My Mastodon</a> | <a href="https://github.com/hococoder" target="_blank">My GitHub</a> | <a href="https://ep.jhu.edu" target="_blank">Whiting School EPP</a> | <a href="https://canvas.jhu.edu" target="_blank">JHU Canvas</a></p></footer></div></body></html>
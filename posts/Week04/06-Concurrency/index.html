<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Mobile Application Development for the iOS Platform"/><link rel="canonical" href="https://hococoder.com/posts/Week04/06-Concurrency"/><meta name="twitter:url" content="https://hococoder.com/posts/Week04/06-Concurrency"/><meta name="og:url" content="https://hococoder.com/posts/Week04/06-Concurrency"/><title>Week 4 - Concurrency | Mobile Application Development for the iOS Platform</title><meta name="twitter:title" content="Week 4 - Concurrency | Mobile Application Development for the iOS Platform"/><meta name="og:title" content="Week 4 - Concurrency | Mobile Application Development for the iOS Platform"/><meta name="description" content="Engineering Program for Professionals - 605.687 - 2024-2025 Academic Year"/><meta name="twitter:description" content="Engineering Program for Professionals - 605.687 - 2024-2025 Academic Year"/><meta name="og:description" content="Engineering Program for Professionals - 605.687 - 2024-2025 Academic Year"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="../../../styles.css" type="text/css"/><script src="../../../../jquery-3.7.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Mobile Application Development for the iOS Platform"/></head><body><div class="layout"><div class="header"><div class="headerLayout"><div class="title">Mobile Application Development for the iOS Platform</div><div class="subtitle">Engineering Program for Professionals - 605.687 - 2024-2025 Academic Year</div><div class="weeklayout"><a class="grow1" href="/epp_605_687_spring_2025/posts/Intro/About Me">About Me</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Intro/Example App">Example App</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week00/00-Week00Overview">Week 0</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week01/00-Week01Overview">Week 1</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week02/00-Week02Overview">Week 2</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week03/00-Week03Overview">Week 3</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week04/00-Week04Overview">Week 4</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week05/00-Week05Overview">Week 5</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week06/00-Week06Overview">Week 6</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week07/00-Week07Overview">Week 7</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week08/00-Week08Overview">Week 8</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week09/00-Week09Overview">Week 9</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week10/00-Week10Overview">Week 10</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week11/00-Week11Overview">Week 11</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week12/00-Week12Overview">Week 12</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week13/00-Week13Overview">Week 13</a></div></div></div><div class="wrapper"><hr><h1>Week 4 - Concurrency</h1><p style="float: left">Previous:  <A HREF="../../Week04/05-AsyncAwait/index.html">Async Await</A></p><p style="float: right">Next:  <A HREF="../../Week04/07-IntroductionToCloudKit/index.html">Introduction to CloudKit</A></p><BR/><BR/><center>
<p class="suggestedReading">
Suggested Reading: <BR/>
<A HREF="https://docs.swift.org/swift-book/LanguageGuide/Concurrency.html">Swift Concurrency</A><BR/>
</p>
</center><div id="floater">
<h3><u>Page Contents</u></h3>
<ul><li><a href="#overview">Overview</a></li><li><a href="#mainactor">@MainActor</a></li><li><a href="#sendableTypes">Sendable Types</a></li><li><a href="#conclusion">Conclusion</a></li></ul></div><a name="overview"></a>
<h2>Overview</h2><p>While <code>Task</code>s, which were introduce in the last module, allow you to make isolated, concurrent pieces of your program, their isolated nature makes it impossible to share information between them.</p><p><code>actor</code>s are class-like reference types that allow one task to access their mutable state at a time. This means that as long as it isn't at the same time, different concurrent pieces of code can access the actor - an improvement over <code>Task</code>s. Here's a student <code>actor</code> that has a private gpa property:</p><pre><code><span class="keyword">actor</span> Student {
  <span class="keyword">let</span> name: <span class="type">String</span>
  <span class="keyword">let</span> major: <span class="type">String</span>
  <span class="keyword">let</span> grades: [<span class="type">Double</span>]
  <span class="keyword">private(set) var</span> gpa: <span class="type">Double</span>

  <span class="keyword">init</span>(name: <span class="type">String</span>, major: <span class="type">String</span>, grades: [<span class="type">Double</span>]) {
    <span class="keyword">self</span>.<span class="property">name</span> = name
    <span class="keyword">self</span>.<span class="property">major</span> = major
    <span class="keyword">self</span>.<span class="property">grades</span> = grades
    <span class="keyword">self</span>.<span class="property">gpa</span> = <span class="call">calculateGPA</span>(<span class="keyword">self</span>.<span class="property">grades</span>)
  }

}
</code></pre><p><code>actor</code>s are made like classes, using the <code>actor</code> keyword instead of the <code>class</code> keyword. They are also used the same way:</p><pre><code><span class="keyword">let</span> johnsmith = <span class="type">Student</span>(name: <span class="string">"John Smith"</span>, major: <span class="string">"Computer Science"</span>, grades: [<span class="number">4.0</span>, <span class="number">3.0</span>])
<span class="call">print</span>(await johnsmith.<span class="property">gpa</span>)
<span class="comment">//prints 3.5</span>
</code></pre><p>Since the system has to check to see if a caller can access <code>johnsmith</code> before asking for its <code>gpa</code> property, <code>johnsmith.gpa</code> is a potential suspension point, so you must <code>await</code> it.</p><p>Functions inside the <code>actor</code> don't need to wait, however, since they are running on the <code>actor</code>:</p><pre><code><span class="keyword">extension</span> <span class="type">Student</span> {
  <span class="keyword">func</span> calculateGPA {
    gpa = grades.<span class="property">map</span>.<span class="call">reduce</span>(<span class="number">0</span>, +)
  }
}
</code></pre><p>If we didn't use an <code>actor</code> here, different threads could come in and change the <code>grades</code> array while another thread was trying to execute <code>calculateGPA</code>. The results would be very uncertain!</p><a name="codeMainactorCode"></a>
<h2><code>@MainActor</code></h2><p>When dealing with background threads and the user interface, you always have to make sure send your UI updates back to the main thread. This can be done with a call to <code>DispatchQueue.main.async</code>, but it can be error-prone and hard to maintain. To help with this, SwiftUI elements are now decorated with the <code>@MainActor</code> property wrapper in their declarations, which mean that all properties and methods on those types will be called on the main queue. For example:</p><pre><code><span class="keyword">func</span> loadJohnSmith() {

  <span class="type">Task</span> {
    <span class="keyword">let</span> johnsmith = <span class="type">Student</span>(name: <span class="string">"John Smith"</span>, major: <span class="string">"Computer Science"</span>, grades: [<span class="number">4.0</span>, <span class="number">3.0</span>])
    nameLabel.<span class="property">text</span> = <span class="keyword">await</span> johnsmith.<span class="property">name</span>
  }
}

</code></pre><p><code>Task</code>, as you saw above, sets up an environment that run blocks of code on background threads. Here, even though <code>nameLabel</code> is updating the UI, there is no need to dispatch to the main queue, because the system does it for you.</p><p>You can also use the <code>@MainActor</code> property wrapper in your own custom types, if they use Swift Concurrency. For example:</p><pre><code><span class="keyword">@MainActor class</span> ClassRosterViewModel: <span class="type">ObservableObject</span> {

  <span class="keyword">@Published</span> students: [<span class="type">Student</span>]

  <span class="keyword">func</span> loadStudents() {
    <span class="type">Task</span> {
      students = <span class="keyword">try await</span> <span class="call">loadStudentsFromDatabase</span>()
    }
  }

}
</code></pre><p>This will cause the <code>@Published</code> <code>students</code> property to get assigned on the main queue, which will make them easier to update in SwiftUI.</p><a name="codeSendableCodeTypes"></a>
<h2><code>Sendable</code> Types</h2><p>When you are working with tasks and actors, the part of the program that contains mutable state, like variables and properties, is called a concurrency domain. Some data - mutable data for example - can't be shared between domains, because it can't guarantee multi-thread access.</p><p><code>Sendable</code> types, however, can be shared from one concurrency type to another. This means these types can be sent as arguments to a function or used a return type. The examples above weren't denoted as <code>Sendable</code> since simple value types are inherently <code>Sendable</code>.</p><p>Some types aren't sendable. For example, a class with mutable properties and doesn't serialize those properties can produce unpredictable results. So, what makes a type <code>Sendable</code> (taken from the Swift documentation)?</p><ul><li>The type is a value type (like a <code>struct</code>) and has mutable state made up of other <code>Sendable</code> data, like stored properties that are themselves <code>Sendable</code>.</li><li>The type doesn't have any mutable state, and the immutable state is made of up <code>Sendable</code> types. A <code>struct</code> with read only properties (getter only).</li><li>The type has code that ensures the safety of its mutable state, like a class marked with @MainActor, or a class that serializes its content on a given thread or queue.</li></ul><p>Let's look at how you might send an <code>UserAssignment</code>:</p><pre><code><span class="keyword">struct</span> UserAssignment: <span class="type">Sendable</span> {
  <span class="keyword">var</span> grade: <span class="type">Double</span>
  <span class="keyword">var</span> comments: <span class="type">String</span> 
}

<span class="keyword">extension</span> <span class="type">UserAssignment</span> {
  <span class="keyword">func</span> addGrade(grade: <span class="type">Double</span>, comments: <span class="type">String</span>) {
    <span class="keyword">self</span>.<span class="property">grade</span> = grade
    <span class="keyword">self</span>.<span class="property">comments</span> = comments
  }
}

<span class="keyword">let</span> assignment1 = <span class="type">UserAssignment</span>()
<span class="keyword">await</span> assignment1.<span class="call">addGrade</span>(grade: <span class="number">85</span>, comments: <span class="string">"Typos galore!"</span>)
</code></pre><p><code>UserAssignment</code> is a value type (a <code>struct</code>) and only has <code>Sendable</code> properties, so it is inherently <code>Sendable</code>. In this case the <code>: Sendable</code> isn't needed explicitly.</p><a name="conclusion"></a>
<h2>Conclusion</h2><p>Swift 6 included the option for enabling strict concurrency checking, which forces the compiler to treat data race issues it detects as errors, not just warnings - causing you to make your projects safer! The homeworks should already be setup this way, and I've tried my best to have you avoid having to worry about this as much as I can, but if you run into issues in either the homework or your final project, please let me know!</p><p style="float: left">Previous:  <A HREF="../../Week04/05-AsyncAwait/index.html">Async Await</A></p><p style="float: right">Next:  <A HREF="../../Week04/07-IntroductionToCloudKit/index.html">Introduction to CloudKit</A></p><BR/><BR/></div><leftside><u><p>Week 4</p></u><div class="weekSection"><ul><li><div class="comment-container"><div class="tocItem"><a id="Week 04 Overview" href="../../Week04/00-Week04Overview/index.html">Week 04 Overview</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Introduction to Networking" href="../../Week04/01-IntroductionToNetworking/index.html">Introduction to Networking</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="URL Session Delegate" href="../../Week04/02-URLSessionDelegate/index.html">URL Session Delegate</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Networking Best Practices" href="../../Week04/03-NetworkingBestPractices/index.html">Networking Best Practices</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Networking Example" href="../../Week04/04-NetworkingExample/index.html">Networking Example</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Async Await" href="../../Week04/05-AsyncAwait/index.html">Async Await</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Concurrency" href="../../Week04/06-Concurrency/index.html">Concurrency</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Introduction to CloudKit" href="../../Week04/07-IntroductionToCloudKit/index.html">Introduction to CloudKit</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Setting Up CloudKit" href="../../Week04/08-SettingUpCloudKit/index.html">Setting Up CloudKit</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="CloudKit Schemas" href="../../Week04/09-CloudKitSchemas/index.html">CloudKit Schemas</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="CloudKit Features" href="../../Week04/10-CloudKitFeatures/index.html">CloudKit Features</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Updating Your App For CloudKit" href="../../Week04/11-UpdatingYourAppForCloudKit/index.html">Updating Your App For CloudKit</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Introduction to Swift Package Manager" href="../../Week04/12-IntroductionToSwiftPackageManager/index.html">Introduction to Swift Package Manager</a></div></div></li></ul></div></leftside><footer><p>Generated with ❤️ using <a href="https://github.com/johnsundell/publish">Publish</a></p><p>© 2023-2024 Josh Steele (rsteele3@jhu.edu) <a href="mailto:"(rsteele3@jhu.edu)""></a></p><p>Last updated March 23, 2025 at 3:44 PM</p><p><a href="https://mastodon.social/@hococoder" target="_blank">My Mastodon</a> | <a href="https://github.com/hococoder" target="_blank">My GitHub</a> | <a href="https://ep.jhu.edu" target="_blank">Whiting School EPP</a> | <a href="https://canvas.jhu.edu" target="_blank">JHU Canvas</a></p></footer></div></body></html>
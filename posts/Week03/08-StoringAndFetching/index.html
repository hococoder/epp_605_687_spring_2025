<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Mobile Application Development for the iOS Platform"/><link rel="canonical" href="https://hococoder.com/posts/Week03/08-StoringAndFetching"/><meta name="twitter:url" content="https://hococoder.com/posts/Week03/08-StoringAndFetching"/><meta name="og:url" content="https://hococoder.com/posts/Week03/08-StoringAndFetching"/><title>Week 3 - Storing and Fetching | Mobile Application Development for the iOS Platform</title><meta name="twitter:title" content="Week 3 - Storing and Fetching | Mobile Application Development for the iOS Platform"/><meta name="og:title" content="Week 3 - Storing and Fetching | Mobile Application Development for the iOS Platform"/><meta name="description" content="A description of my first post."/><meta name="twitter:description" content="A description of my first post."/><meta name="og:description" content="A description of my first post."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="../../../styles.css" type="text/css"/><script src="../../../../jquery-3.7.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Mobile Application Development for the iOS Platform"/></head><body><div class="layout"><div class="header"><div class="headerLayout"><div class="title">Mobile Application Development for the iOS Platform</div><div class="subtitle">Engineering Program for Professionals - 605.687 - 2024-2025 Academic Year</div><div class="weeklayout"><a class="grow1" href="/epp_605_687_fall_2024/posts/Intro/About Me">About Me</a><a class="grow1" href="/epp_605_687_fall_2024/posts/Intro/Example App">Example App</a><a class="grow1" href="/epp_605_687_fall_2024/posts/Week00/00-Week00Overview">Week 0</a><a class="grow1" href="/epp_605_687_fall_2024/posts/Week01/00-Week01Overview">Week 1</a><a class="grow1" href="/epp_605_687_fall_2024/posts/Week02/00-Week02Overview">Week 2</a><a class="grow1" href="/epp_605_687_fall_2024/posts/Week03/00-Week03Overview">Week 3</a><a class="grow1" href="/epp_605_687_fall_2024/posts/Week04/00-Week04Overview">Week 4</a><a class="grow1" href="/epp_605_687_fall_2024/posts/Week05/00-Week05Overview">Week 5</a><a class="grow1" href="/epp_605_687_fall_2024/posts/Week06/00-Week06Overview">Week 6</a><a class="grow1" href="/epp_605_687_fall_2024/posts/Week07/00-Week07Overview">Week 7</a><a class="grow1" href="/epp_605_687_fall_2024/posts/Week08/00-Week08Overview">Week 8</a><a class="grow1" href="/epp_605_687_fall_2024/posts/Week09/00-Week09Overview">Week 9</a><a class="grow1" href="/epp_605_687_fall_2024/posts/Week10/00-Week10Overview">Week 10</a><a class="grow1" href="/epp_605_687_fall_2024/posts/Week11/00-Week11Overview">Week 11</a><a class="grow1" href="/epp_605_687_fall_2024/posts/Week12/00-Week12Overview">Week 12</a><a class="grow1" href="/epp_605_687_fall_2024/posts/Week13/00-Week13Overview">Week 13</a></div></div></div><div class="wrapper"><h1>Week 3 - Storing and Fetching</h1><p style="float: left">Previous:  <A HREF="../../Week03/07-NSManagedObjects/index.html">NSManagedObjects</A></p><p style="float: right">Next:  <A HREF="../../Week03/09-PopulatingTheDatabase/index.html">Populating the Database</A></p><BR/><BR/><a name="overview"></a>
<h2>Overview</h2><div id="floater">
<h3><u>Page Contents</u></h3>
<ul><li><a href="#overview">Overview</a></li><li><a href="#makingFetches">Making Fetches</a></li><li><a href="#storingData">Storing Data</a></li><li><a href="#definingRelationships">Defining Relationships</a></li><li><a href="#deletingEntries">Deleting Entries</a></li></ul></div><p class="info">This Core Data information is left here for posterity; we will be focusing on using Swift Data from here on out in the class</p><p>With the database schema in place, we know the types, attributes and relationships that we want to use in our app. This brings us to how we get data into, and get data from, the database. Again, Core Data comes to the rescue with some nice API, and the availability of the global <code>shared</code> <code>PersistenceController</code> object from the <code>Persistence.swift</code> file.</p><a name="makingFetches"></a>
<h2>Making Fetches</h2><p>Once you have everything setup (through your schema or with custom <code>NSManagedObject</code> instances), it’s pretty easy to make a request. To create a fetch request for the entity, you can use the entity's built in <code>fetchRequest()</code> method. Once you’ve formulated the fetch request, you can execute it on the context to get a list of results back. Fetches from the database can range from simple to complex (as with any database), but a simple one to grab all of the rows for the <code>DBSample</code> entity is shown here.</p><pre><code><span class="keyword">let</span> context = <span class="type">PersistenceController</span>.<span class="property">shared</span>.<span class="property">container</span>.<span class="property">viewContext</span>
<span class="keyword">let</span> fetchRequest = <span class="type">NSFetchRequest</span>&lt;<span class="type">DBSample</span>&gt; = <span class="type">DBSample</span>.<span class="call">fetchRequest</span>()
<span class="comment">// additional modifications to the request can be made here
// for example, predicates that define which attribute ranges to search on</span>
<span class="keyword">do</span> {
  <span class="keyword">let</span> results = <span class="keyword">try</span> context.<span class="call">execute</span>(fetchRequest)
} <span class="keyword">catch</span> {
  <span class="keyword">let</span> nsError = error <span class="keyword">as</span> <span class="type">NSError</span>
  <span class="call">fatalError</span>(<span class="string">"Unresolved error</span> \(nsError)<span class="string">,</span> \(nsError.<span class="property">userInfo</span>)<span class="string">"</span>)
}
</code></pre><a name="storingData"></a>
<h2>Storing Data</h2><p>To store data, you'll first need to make an instance of the entity in question. With your context in hand, you can use <code>NSEntityDescription</code>’s <code>insertNewObject</code> method to make a new instance of the entity based on the attributes in the entity’s table (which exists in the context until you save it), and from that point on when you modify that object, the values for that row will get updated when your changes get pushed down to the database.</p><pre><code><span class="keyword">let</span> context = <span class="type">PersistenceController</span>.<span class="property">shared</span>.<span class="property">container</span>.<span class="property">viewContext</span>
<span class="keyword">let</span> sample = <span class="type">NSEntityDescription</span>.<span class="call">insertNewObject</span>(forEntityName: <span class="string">"DBSample"</span>, into: context) <span class="keyword">as</span>! <span class="type">DBSample</span>
<span class="comment">// set properties on sample before saving....</span>

<span class="keyword">do</span> {
  <span class="keyword">let</span> results = <span class="keyword">try</span> context.<span class="call">save</span>()
} <span class="keyword">catch</span> {
  <span class="keyword">let</span> nsError = error <span class="keyword">as</span> <span class="type">NSError</span>
  <span class="call">fatalError</span>(<span class="string">"Unresolved error</span> \(nsError)<span class="string">,</span> \(nsError.<span class="property">userInfo</span>)<span class="string">"</span>)
}
</code></pre><p>You can also use a slightly different technique:</p><pre><code><span class="keyword">let</span> context = <span class="type">PersistenceController</span>.<span class="property">shared</span>.<span class="property">container</span>.<span class="property">viewContext</span>
<span class="keyword">let</span> sample = <span class="type">DBSample</span>(context: context)
<span class="comment">// set properties on sample before saving....</span>

<span class="keyword">do</span> {
  <span class="keyword">let</span> results = <span class="keyword">try</span> context.<span class="call">save</span>()
} <span class="keyword">catch</span> {
  <span class="keyword">let</span> nsError = error <span class="keyword">as</span> <span class="type">NSError</span>
  <span class="call">fatalError</span>(<span class="string">"Unresolved error</span> \(nsError)<span class="string">,</span> \(nsError.<span class="property">userInfo</span>)<span class="string">"</span>)
}

</code></pre><p>Since <code>DBSample</code> extends <code>NSManageObject</code> it gets an inherited initializer that takes in a <code>NSManagedObjectContext</code> that can be use to initialize an instance of that object in the context and return it. You can use this technique in an extension of the class to create a static method that takes in the parameters for the entity and insert it into the context:</p><pre><code><span class="keyword">extension</span> <span class="type">DBSample</span> {

    <span class="keyword">static func</span> createWith(
      property1: <span class="type">String</span>,
      property2: <span class="type">Bool</span>,
      property3: <span class="type">Int</span>,
    in context: <span class="type">NSManagedObjectContext</span>
  ) {

    <span class="keyword">let</span> item = <span class="type">DBSample</span>(context: context)
    item.<span class="property">property1</span> = property1
    item.<span class="property">property2</span> = property2
    item.<span class="property">property3</span> = property3

    <span class="keyword">do</span> {
      <span class="keyword">try</span> context.<span class="call">save</span>()
    } <span class="keyword">catch</span> {
      <span class="call">fatalError</span>(<span class="string">"Problem saving to do item"</span>)
    }
  }
}
</code></pre><p>The above method would of course have to be customized for your particular class, but the pattern is the same for each object you make.</p><a name="definingRelationships"></a>
<h2>Defining relationships</h2><p>Like all databases, you can establish relationships between your entities.</p><p>If you had 2 instances of a <code>AssignmentGrade</code> entity with different <code>grade</code>s and <code>graderComment</code>s, as well as an <code>Assignment</code> those grades belong to (read: are related to), you can assign those grades to that assignment. Note that you only have to define the relationship in one direction - your schema implies that the assignment has 2 members in the "grades" set once the assignment grades set their assignment object.</p><pre><code><span class="keyword">let</span> context = <span class="type">PersistenceController</span>.<span class="property">shared</span>.<span class="property">container</span>.<span class="property">viewContext</span>

<span class="keyword">let</span> assignmentGrade1 = <span class="type">AssignmentGrade</span>(context: context) 
assignmentGrade1.<span class="property">grade</span> = <span class="number">90.0</span>
assignmentGrade1.<span class="property">graderComments</span> = <span class="string">"Pretty good job!"</span>

<span class="keyword">let</span> assignmentGrade2 = <span class="type">AssignmentGrade</span>(context: context)
assignmentGrade2.<span class="property">grade</span> = <span class="number">65</span>
assignmentGrade2.<span class="property">graderComments</span> = <span class="string">"Several days late, and it wouldn't compile!"</span>

<span class="keyword">let</span> assignment = <span class="type">Assignment</span>(context: context)
assignment.<span class="property">name</span> = <span class="string">"Programming Assignment 1"</span>
assignment.<span class="property">assignmentDescription</span> = <span class="string">"Build out your model"</span>
assignment.<span class="property">assignmentType</span> = <span class="string">"Programming Assignment"</span>
assignment.<span class="property">averageRating</span> = <span class="number">3.7</span>  
<span class="comment">//other attributes after this....

//Now setup the relationships - note we only have to define one direction!</span>
assignment.<span class="call">addToGrades</span>(assignmentGrade1)
assignment.<span class="call">addToGrades</span>(assignmentGrade2)

<span class="keyword">try</span> context.<span class="call">saveContext</span>()
</code></pre><p>As with other entities, once you've defined the entities and set their attributes, ask the context to save to push the data to the database.</p><p>If you want to fetch those assignments grades, the syntax is a little atypical:</p><pre><code><span class="keyword">let</span> fetchRequest: <span class="type">NSFetchRequest</span>&lt;<span class="type">Assignment</span>&gt; = <span class="type">Assignment</span>.<span class="call">fetchRequest</span>()
<span class="keyword">let</span> assignments = <span class="keyword">try</span> context.<span class="call">fetch</span>(fetchRequest)
<span class="keyword">let</span> assignmentGrades: [<span class="type">AssignmentGrade</span>] = assignments[<span class="number">0</span>].grades!.allObjects <span class="keyword">as</span>! [<span class="type">AssignmentGrade</span>]
</code></pre><p>Due to how the objects are stored, you have to get the grades for the assignment in question, then convert it to an array with <code>allObjects</code> and then cast it with <code>as! [AssignmentGrade]</code>. Yeah, it's not pretty. But it's what we've got!</p><a name="deletingEntries"></a>
<h2>Deleting entries</h2><p>If you no longer need entries in the database, you can mark them for deletion. In the method below, you can see that the items are fetched via a <code>fetchRequest</code>, and for each item you want to delete, you can call <code>context.delete($0)</code>. Note that this is just like a normal change to the context, so you still need to call <code>context.save()</code> to push the change to the database.</p><pre><code><span class="keyword">func</span> deleteAllTeachers(context: <span class="type">NSManagedObjectContext</span>) {
    
  <span class="keyword">let</span> fetchRequest: <span class="type">NSFetchRequest</span>&lt;<span class="type">Teacher</span>&gt; = <span class="type">Teacher</span>.<span class="call">fetchRequest</span>()
  <span class="keyword">do</span> {
    <span class="keyword">let</span> teachers = <span class="keyword">try</span> context.<span class="call">fetch</span>(fetchRequest)
    teachers.<span class="property">forEach</span>{ context.<span class="call">delete</span>($0) }
    context.<span class="call">save</span>()
  } <span class="keyword">catch</span> {
    <span class="call">print</span>(<span class="string">"Error deleting all teachers,</span> \(error)<span class="string">"</span>)
  }
}
</code></pre><p>So you know all about storing and fetching data. But how can you prepopulate data in the database before your app starts? You'll find out one way in the next module.</p><p style="float: left">Previous:  <A HREF="../../Week03/07-NSManagedObjects/index.html">NSManagedObjects</A></p><p style="float: right">Next:  <A HREF="../../Week03/09-PopulatingTheDatabase/index.html">Populating the Database</A></p><BR/><BR/></div><leftside><u><p>Week 3</p></u><div class="weekSection"><ul><li><div class="comment-container"><div class="tocItem"><a id="Week 3 Overview" href="../../Week03/00-Week3Overview/index.html">Week 3 Overview</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Your Apps Directory Structure" href="../../Week03/01-YourAppsDirectoryStructure/index.html">Your Apps Directory Structure</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Introduction to User Defaults" href="../../Week03/02-IntroductionToUserDefaults/index.html">Introduction to User Defaults</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Introduction to the Codable Protocol" href="../../Week03/03-IntroductionToTheCodableProtocol/index.html">Introduction to the Codable Protocol</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Introduction to SwiftData" href="../../Week03/04-IntroductionToSwiftData/index.html">Introduction to SwiftData</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Introduction to CoreData" href="../../Week03/05-IntroductionToCoreData/index.html">Introduction to CoreData</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Setting up a Schema" href="../../Week03/06-SettingUpASchema/index.html">Setting up a Schema</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="NSManagedObjects" href="../../Week03/07-NSManagedObjects/index.html">NSManagedObjects</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Storing and Fetching" href="../../Week03/08-StoringAndFetching/index.html">Storing and Fetching</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Populating the Database" href="../../Week03/09-PopulatingTheDatabase/index.html">Populating the Database</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="SwiftUI Improvements" href="../../Week03/10-SwiftUIImprovements/index.html">SwiftUI Improvements</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Converting to SwiftData" href="../../Week03/11-ConvertingToSwiftData/index.html">Converting to SwiftData</a></div></div></li></ul></div></leftside><footer><p>Generated with ❤️ using <a href="https://github.com/johnsundell/publish">Publish</a></p><p>© 2023-2024 Josh Steele (rsteele3@jhu.edu) <a href="mailto:"(rsteele3@jhu.edu)""></a></p><p>Last updated January 18, 2025 at 2:12 PM</p><p><a href="https://mastodon.social/@hococoder" target="_blank">My Mastodon</a> | <a href="https://github.com/hococoder" target="_blank">My GitHub</a> | <a href="https://ep.jhu.edu" target="_blank">Whiting School EPP</a> | <a href="https://canvas.jhu.edu" target="_blank">JHU Canvas</a></p></footer></div></body></html>
<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Mobile Application Development for the iOS Platform"/><link rel="canonical" href="https://hococoder.com/posts/Week09/06-HKStatistics"/><meta name="twitter:url" content="https://hococoder.com/posts/Week09/06-HKStatistics"/><meta name="og:url" content="https://hococoder.com/posts/Week09/06-HKStatistics"/><title>Week 9 - HealthKit Statistics | Mobile Application Development for the iOS Platform</title><meta name="twitter:title" content="Week 9 - HealthKit Statistics | Mobile Application Development for the iOS Platform"/><meta name="og:title" content="Week 9 - HealthKit Statistics | Mobile Application Development for the iOS Platform"/><meta name="description" content="A description of my first post."/><meta name="twitter:description" content="A description of my first post."/><meta name="og:description" content="A description of my first post."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="../../../styles.css" type="text/css"/><script src="../../../../jquery-3.7.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Mobile Application Development for the iOS Platform"/></head><body><div class="layout"><div class="header"><div class="headerLayout"><div class="title">Mobile Application Development for the iOS Platform</div><div class="subtitle">Engineering Program for Professionals - 605.687 - 2024-2025 Academic Year</div><div class="weeklayout"><a class="grow1" href="/epp_605_687_spring_2025/posts/Intro/About Me">About Me</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Intro/Example App">Example App</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week00/00-Week00Overview">Week 0</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week01/00-Week01Overview">Week 1</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week02/00-Week02Overview">Week 2</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week03/00-Week03Overview">Week 3</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week04/00-Week04Overview">Week 4</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week05/00-Week05Overview">Week 5</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week06/00-Week06Overview">Week 6</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week07/00-Week07Overview">Week 7</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week08/00-Week08Overview">Week 8</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week09/00-Week09Overview">Week 9</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week10/00-Week10Overview">Week 10</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week11/00-Week11Overview">Week 11</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week12/00-Week12Overview">Week 12</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week13/00-Week13Overview">Week 13</a></div></div></div><div class="wrapper"><h1>Week 9 - HealthKit Statistics</h1><p style="float: left">Previous:  <A HREF="../../Week09/05-HKQueries/index.html">HKQueries</A></p><p style="float: right">Next:  <A HREF="../../Week09/07-HKWriteData/index.html">HKWriteData</A></p><BR/><BR/><a name="exampleGettingStatisticsOnData"></a>
<h2>Example - Getting Statistics on Data</h2><center><iframe id="myIframe" src="https://jh.hosted.panopto.com/Panopto/Pages/Embed.aspx?id=ca44e7a5-e2a3-46a9-928d-b1bb0119cb38&autoplay=false&offerviewer=true&showtitle=true&showbrand=true&captions=false&interactivity=all"  style="border: 1px solid #464646;" allowfullscreen allow="autoplay" aria-label="Panopto Embedded Video Player" aria-description="Week0-04-THIRDPARTYTOOLS-Lecture" ></iframe></center><p>For some values, like steps, you want to get a total number over a given time period to give you a sense of how close you are to completing your goal. Luckily, HealthKit comes with a <code>HKStatisticsQuery</code> class that does all the hard work for you. Let's start by adding a <code>steps</code> property to <code>HealthKitDataHelper</code></p><pre><code><span class="comment">//add at the top of the class</span>
<span class="keyword">@Published var</span> steps: <span class="type">Double</span> = <span class="number">0.0</span>
</code></pre><p>Then make the <code>getTodaysSteps</code> function, which will only take in a completion handler to deal with the response from HealthKit.</p><pre><code><span class="comment">//Query to ready today's steps, using HKStatisticsQuery, which does summation for us</span>
<span class="keyword">func</span> getTodaysSteps(completion: <span class="keyword">@escaping</span> (<span class="type">Double</span>) -&gt; <span class="type">Void</span>) {
</code></pre><p>Define the type we want to use by using the <code>.stepCount</code> identifier</p><pre><code>  <span class="keyword">let</span> stepsQuantityType = <span class="type">HKQuantityType</span>.<span class="call">quantityType</span>(forIdentifier: .<span class="dotAccess">stepCount</span>)!
</code></pre><p>Build a predicate to get the steps for today, using <code>Date()</code> to grab the current date/time, and the <code>Calendar.current.startOfDay</code> function to get the start of the current day.</p><pre><code>  <span class="keyword">let</span> now = <span class="type">Date</span>()
  <span class="keyword">let</span> startOfDay = <span class="type">Calendar</span>.<span class="property">current</span>.<span class="call">startOfDay</span>(for: now)
  <span class="keyword">let</span> predicate = <span class="type">HKQuery</span>.<span class="call">predicateForSamples</span>(withStart: startOfDay, end: now, options: .<span class="dotAccess">strictStartDate</span>)
</code></pre><p>Build the <code>HKStatisticsQuery</code> using the type and predicate we defined above, and choose <code>cumulativeSum</code> as the option, so we get a complete summation of all of the steps for today. In the completion handler, check for errors, and if there is one, call the completion handler with a value of 0, and return; otherwise, call the completion handler with the sum as the argument.</p><pre><code>  <span class="keyword">let</span> query = <span class="type">HKStatisticsQuery</span>(quantityType: stepsQuantityType, quantitySamplePredicate: predicate, options: .<span class="dotAccess">cumulativeSum</span>) { <span class="keyword">_</span>, result, <span class="keyword">_ in
      guard let</span> result = result, <span class="keyword">let</span> sum = result.<span class="call">sumQuantity</span>() <span class="keyword">else</span> {
          <span class="call">completion</span>(<span class="number">0.0</span>)
          <span class="keyword">return</span>
      }
      <span class="call">completion</span>(sum.<span class="call">doubleValue</span>(for: <span class="type">HKUnit</span>.<span class="call">count</span>()))
  }
</code></pre><p>Don't forget to execute the <code>query</code> on the <code>HKHealthStore()</code> when you're done defining it!</p><pre><code>  <span class="type">HKHealthStore</span>().<span class="call">execute</span>(query)
}
</code></pre><p>To be able to view this in the simulator, add the following to the <code>Form</code> in our view</p><pre><code><span class="type">HStack</span> {
  <span class="type">Text</span>(<span class="string">"Steps"</span>)
  <span class="type">Spacer</span>()
  <span class="type">Text</span>(<span class="string">"</span>\(numberFormatter.<span class="call">string</span>(from: <span class="type">NSNumber</span>(value: hkData.<span class="property">steps</span>))!)<span class="string">"</span>)
}
</code></pre><p>Run this in the simulator. Initially, the app will show the value currently in the HK Store, and if we go to the Health app and add new values, and then return to our app, nothing happens! We need some way to tell the view to refresh itself when returning to the foreground. Luckily, Notification center sends notices out when apps enter the foreground, so let's attach the following modifier onto the <code>Form</code> in our view:</p><pre><code>.<span class="call">onReceive</span>(<span class="type">NotificationCenter</span>.<span class="property">default</span>.<span class="call">publisher</span>(for: <span class="type">UIApplication</span>.<span class="property">willEnterForegroundNotification</span>)) { <span class="keyword">_ in
  self</span>.<span class="property">hkData</span>.<span class="call">loadData</span>()
}
</code></pre><p>This will call <code>loadData</code> again when the app enters the foreground. Add new step values into the Health app again, and bounce back to the app via the home buttons - you'll see that a new summed value is displayed, as you would expect.</p><p>If you have any questions about the examples in this video, please post them in the forums.</p><p style="float: left">Previous:  <A HREF="../../Week09/05-HKQueries/index.html">HKQueries</A></p><p style="float: right">Next:  <A HREF="../../Week09/07-HKWriteData/index.html">HKWriteData</A></p><BR/><BR/></div><leftside><u><p>Week 9</p></u><div class="weekSection"><ul><li><div class="comment-container"><div class="tocItem"><a id="Week 09 Overview" href="../../Week09/00-Week09Overview/index.html">Week 09 Overview</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Introduction to HealthKit" href="../../Week09/01-IntroductionToHealthKit/index.html">Introduction to HealthKit</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="HKEnabling" href="../../Week09/02-HKEnabling/index.html">HKEnabling</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="HKAccess" href="../../Week09/03-HKAccess/index.html">HKAccess</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="HKStaticData" href="../../Week09/04-HKStaticData/index.html">HKStaticData</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="HKQueries" href="../../Week09/05-HKQueries/index.html">HKQueries</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="HKStatistics" href="../../Week09/06-HKStatistics/index.html">HKStatistics</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="HKWriteData" href="../../Week09/07-HKWriteData/index.html">HKWriteData</a></div></div></li></ul></div></leftside><footer><p>Generated with ❤️ using <a href="https://github.com/johnsundell/publish">Publish</a></p><p>© 2023-2024 Josh Steele (rsteele3@jhu.edu) <a href="mailto:"(rsteele3@jhu.edu)""></a></p><p>Last updated January 26, 2025 at 12:00 PM</p><p><a href="https://mastodon.social/@hococoder" target="_blank">My Mastodon</a> | <a href="https://github.com/hococoder" target="_blank">My GitHub</a> | <a href="https://ep.jhu.edu" target="_blank">Whiting School EPP</a> | <a href="https://canvas.jhu.edu" target="_blank">JHU Canvas</a></p></footer></div></body></html>
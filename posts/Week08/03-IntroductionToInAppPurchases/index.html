<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Mobile Application Development for the iOS Platform"/><link rel="canonical" href="https://hococoder.com/posts/Week08/03-IntroductionToInAppPurchases"/><meta name="twitter:url" content="https://hococoder.com/posts/Week08/03-IntroductionToInAppPurchases"/><meta name="og:url" content="https://hococoder.com/posts/Week08/03-IntroductionToInAppPurchases"/><title>Week 8 - Introduction to In App Purchases | Mobile Application Development for the iOS Platform</title><meta name="twitter:title" content="Week 8 - Introduction to In App Purchases | Mobile Application Development for the iOS Platform"/><meta name="og:title" content="Week 8 - Introduction to In App Purchases | Mobile Application Development for the iOS Platform"/><meta name="description" content="A description of my first post."/><meta name="twitter:description" content="A description of my first post."/><meta name="og:description" content="A description of my first post."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="../../../styles.css" type="text/css"/><script src="../../../../jquery-3.7.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Mobile Application Development for the iOS Platform"/></head><body><div class="layout"><div class="header"><div class="headerLayout"><div class="title">Mobile Application Development for the iOS Platform</div><div class="subtitle">Engineering Program for Professionals - 605.687 - 2024-2025 Academic Year</div><div class="weeklayout"><a class="grow1" href="/epp_605_687_spring_2025/posts/Intro/About Me">About Me</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Intro/Example App">Example App</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week00/00-Week00Overview">Week 0</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week01/00-Week01Overview">Week 1</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week02/00-Week02Overview">Week 2</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week03/00-Week03Overview">Week 3</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week04/00-Week04Overview">Week 4</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week05/00-Week05Overview">Week 5</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week06/00-Week06Overview">Week 6</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week07/00-Week07Overview">Week 7</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week08/00-Week08Overview">Week 8</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week09/00-Week09Overview">Week 9</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week10/00-Week10Overview">Week 10</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week11/00-Week11Overview">Week 11</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week12/00-Week12Overview">Week 12</a><a class="grow1" href="/epp_605_687_spring_2025/posts/Week13/00-Week13Overview">Week 13</a></div></div></div><div class="wrapper"><h1>Week 8 - Introduction to In App Purchases</h1><p style="float: left">Previous:  <A HREF="../../Week08/02-AVKitExample/index.html">AVKit Example</A></p><p style="float: right">Next:  <A HREF="../../Week08/04-IAPEnabling/index.html">IAP Enabling</A></p><BR/><BR/><div id="floater">
<h3><u>Page Contents</u></h3>
<ul><li><a href="#overview">Overview</a></li><li><a href="#settingUpWithAppStoreConnect">Setting up with App Store Connect</a></li><li><a href="#iapProducts">IAP Products</a></li><li><a href="#iapProductsAreUnique"> IAP Products are Unique!</a></li><li><a href="#makingPayments">Making Payments</a></li></ul></div><a name="overview"></a>
<h2>Overview</h2><center>
<p class="suggestedReading">
Suggested Reading: <BR/>
<A HREF="https://developer.apple.com/documentation/storekit/in-app_purchase">In App Purchases (Apple Documentation)</A><BR/>
</p>
</center><center><iframe id="myIframe" src="https://jh.hosted.panopto.com/Panopto/Pages/Embed.aspx?id=44acfefe-4478-437e-8f58-b1bb01186b62&autoplay=false&offerviewer=true&showtitle=true&showbrand=true&captions=false&interactivity=all"  style="border: 1px solid #464646;" allowfullscreen allow="autoplay" aria-label="Panopto Embedded Video Player" aria-description="Week0-04-THIRDPARTYTOOLS-Lecture" ></iframe></center><p>In App Purchases are pretty self explanatory - they allow you to sell app related goods within your app, without having to jump out to the app store. Since they were introduced, there has been a transition from paid apps to free apps with IAP, or so called freemium or free-to-play models. The free price gets the app downloaded and the user engaged, and in app purchases - if implemented correctly - keep them coming back for more. Premium content, virtual goods and subscriptions can all be purchased with IAP.</p><a name="settingUpWithAppStoreConnect"></a>
<h2>Setting up with App Store Connect</h2><p>Before you sell your app (for anything other than “free”), or sell In App Purchases, you have to do a few things. App Store Connect, which we’ll talk about in a later module, allows you to enter bank and tax information, and sign a paid applications agreement. Note that you can only do this with a paid developer account - your free development profiles you get with your Apple ID will not work.</p><p>You’ll need to toggle the In App Purchase capability in your Xcode project, and then you’ll need to create the actual In App Purchase content in App Store Connect. However, there is a middle ground, described below.</p><p class="new"> As of iOS 14/Xcode 12 - you can now setup StoreKit Configuration Files in Xcode, which allows you to test your In App Purchases BEFORE you get content in App Store Connect - we'll see this in the updated example code! Note that because of this the code will differ from the videos. </p><a name="theInAppPurchaseProcess"></a>
<h2>The In App Purchase Process</h2><p>This diagram shows the various phases of the purchase process.</p><img src="https://docs-assets.developer.apple.com/published/ca88a04bfb/bb350a89-7040-413c-aad2-7abe994f0c53.png#centerResizedSlide" alt="The IAP Process"/><p>First, you need to get information about the available IAP for your app. This can be done by querying the App Store for information, and then displaying that in a custom storefront in your app. This is the top set of boxes in the images above.</p><p>Then, the user selects what they want to purchase, clicks “Purchase” (or some other button in your app), which makes a request to the App Store to process the payment. This process is performed asynchronously, and your app gets notified via an observer when the store has completed the transaction. At that point the content purchases is either unlocked or downloaded to the app. This is represented by the lower 2 sets of boxes in the image above.</p><a name="iapProducts"></a>
<h2>IAP Products</h2><p>Here are the various types of IAP products.</p><ul><li><strong>Consumables</strong> represent items such as gems in a game. They are used once, can be bought again.</li><li><strong>Non-consumables</strong> represent such items as filters in a photo app. They don’t expire, and if desired, can be hosted by Apple.</li><li><strong>Auto-renewable subscriptions</strong>, such as a magazine subscription and non-renewable subscriptions such as an iTunes season pass for your favorite TV show are the other 2 types.</li></ul><a name="iapItemsAreUnique"></a>
<h2>IAP Items are Unique!</h2><p>IAP items, like the apps they belong to, have unique product identifiers that you setup in App Store Connect. The list of products may be static - so you can bundle it with your app inside a property list - or dynamic, so you can download it from your server via a JSON file. The list of products can then be validated against the App Store’s current list of available products and displayed to user.</p><a name="makingPayments"></a>
<h2>Making Payments</h2><p>To create a payment, you use <code>StoreKit</code>, which gives you a pretty straightforward API. Once you’ve gotten a product from making a request to the app store, you create an <code>SKPayment</code>, set the quantity, and put the payment on the <code>SKPaymentQueue</code>’s default queue, which sends it to the App Store for processing.</p><h3>StoreKit 1 version</h3><pre><code><span class="keyword">let</span> product = *product object from products request*
<span class="keyword">var</span> payment = <span class="type">SKPayment</span>(product:product) 
payment.<span class="property">quantity</span> = <span class="number">2</span>
<span class="type">SKPaymentQueue</span>.<span class="property">default</span>.<span class="call">add</span>(payment)
</code></pre><p class="new">StoreKit 2 is new, and has a much simpler API to work with - we'll use that going forward, but I'll keep examples from StoreKit 1.  Please note the videos only show StoreKit 1!</p><h3>StoreKit 2 Version</h3><pre><code><span class="keyword">let</span> product = *product object from products request*
<span class="keyword">let</span> result = <span class="keyword">try await</span> product.<span class="call">purchase</span>(options: [<span class="type">Product</span>.<span class="type">PurchaseOption</span>.<span class="call">quantity</span>(<span class="number">2</span>)])
</code></pre><p>There are ways to combat fraud when dealing with purchases - the "Purchase Validation" section at the URL in the suggested reading section above has more details.</p><p>As mentioned earlier, the payment request is sent asynchronously, so you establish an observer to hang around and wait for a response. The <code>SKPaymentTransactionObserver</code> handles this behavior, and provides status as to how the purchases is proceeding so you can keep you user informed. Once you make a purchase, you need to make sure that purchase is persisted so that on both future launches and app restores so the user’s IAP is intact. You can do this on your own server, in iCloud, or in user defaults.<br><br>When you get the OK from the App Store about the purchase, you need to finish the transaction. First, deliver the content:</p><ul><li>Either unlock content by setting flags in your code to enable certain content, or download the new content to your app.</li><li>For smaller purchases, embed them in your app, and simply unlock them when purchases.</li><li>For larger ones, download them - Apple can even host this content for you, and you can use the <code>SKDownload</code> class to get that data from the store.</li></ul><p>Finally, when you’re done, ask the <code>SKPaymentQueue</code> to finish the current transaction, and voila - your user now has new content in their app!</p><p style="float: left">Previous:  <A HREF="../../Week08/02-AVKitExample/index.html">AVKit Example</A></p><p style="float: right">Next:  <A HREF="../../Week08/04-IAPEnabling/index.html">IAP Enabling</A></p><BR/><BR/></div><leftside><u><p>Week 8</p></u><div class="weekSection"><ul><li><div class="comment-container"><div class="tocItem"><a id="Week 08 Overview" href="../../Week08/00-Week08Overview/index.html">Week 08 Overview</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Introduction to AVKit" href="../../Week08/01-IntroductionToAVKit/index.html">Introduction to AVKit</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="AVKit Example" href="../../Week08/02-AVKitExample/index.html">AVKit Example</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="Introduction to InAppPurchases" href="../../Week08/03-IntroductionToInAppPurchases/index.html">Introduction to InAppPurchases</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="IAP Enabling" href="../../Week08/04-IAPEnabling/index.html">IAP Enabling</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="IAP Creating" href="../../Week08/05-IAPCreating/index.html">IAP Creating</a></div><div class="chain chain-bottom"></div></div></li><li><div class="comment-container"><div class="chain chain-top"></div><div class="tocItem"><a id="IAP Items List" href="../../Week08/06-IAPItemsList/index.html">IAP Items List</a></div></div></li></ul></div></leftside><footer><p>Generated with ❤️ using <a href="https://github.com/johnsundell/publish">Publish</a></p><p>© 2023-2024 Josh Steele (rsteele3@jhu.edu) <a href="mailto:"(rsteele3@jhu.edu)""></a></p><p>Last updated March 9, 2025 at 6:49 PM</p><p><a href="https://mastodon.social/@hococoder" target="_blank">My Mastodon</a> | <a href="https://github.com/hococoder" target="_blank">My GitHub</a> | <a href="https://ep.jhu.edu" target="_blank">Whiting School EPP</a> | <a href="https://canvas.jhu.edu" target="_blank">JHU Canvas</a></p></footer></div></body></html>